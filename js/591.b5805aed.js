"use strict";(self["webpackChunkforum_front_end_vue"]=self["webpackChunkforum_front_end_vue"]||[]).push([[591],{1568:function(t,e,a){a.d(e,{Z:function(){return m}});var r=function(){var t=this,e=t._self._c;return e("main",{attrs:{role:"main"}},[e("div",{staticClass:"album py-5 bg-light"},[e("div",{staticClass:"container"},[e("form",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"name"}},[t._v("Name")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.restaurant.name,expression:"restaurant.name"}],staticClass:"form-control",attrs:{type:"text",name:"name",id:"name",placeholder:"Enter name",value:""},domProps:{value:t.restaurant.name},on:{input:function(e){e.target.composing||t.$set(t.restaurant,"name",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"categoryId"}},[t._v("Category")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.restaurant.CategoryId,expression:"restaurant.CategoryId"}],staticClass:"form-control",attrs:{id:"categoryId",name:"categoryId",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.restaurant,"CategoryId",e.target.multiple?a:a[0])}}},t._l(t.categories,(function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v(" "+t._s(a.name)+" ")])})),0)]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tel"}},[t._v("Tel")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.restaurant.tel,expression:"restaurant.tel"}],staticClass:"form-control",attrs:{type:"text",name:"tel",id:"tel",placeholder:"Enter tel",value:""},domProps:{value:t.restaurant.tel},on:{input:function(e){e.target.composing||t.$set(t.restaurant,"tel",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"address"}},[t._v("Address")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.restaurant.address,expression:"restaurant.address"}],staticClass:"form-control",attrs:{type:"text",name:"address",id:"address",placeholder:"Enter address",value:""},domProps:{value:t.restaurant.address},on:{input:function(e){e.target.composing||t.$set(t.restaurant,"address",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"opening_hours"}},[t._v("Opening Hours")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.restaurant.opening_hours,expression:"restaurant.opening_hours"}],staticClass:"form-control",attrs:{type:"time",name:"opening_hours",id:"opening_hours",placeholder:"Enter opening_hours",value:""},domProps:{value:t.restaurant.opening_hours},on:{input:function(e){e.target.composing||t.$set(t.restaurant,"opening_hours",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"description"}},[t._v("Description")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.restaurant.description,expression:"restaurant.description"}],staticClass:"form-control",attrs:{id:"description",name:"description",rows:"3"},domProps:{value:t.restaurant.description},on:{input:function(e){e.target.composing||t.$set(t.restaurant,"description",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"image"}},[t._v("Image")]),e("br"),t.restaurant.image?e("img",{staticClass:"d-block img-thumbnail mb-3",attrs:{src:t._f("emptyImage")(t.restaurant.image),width:"150",height:"150"}}):t._e(),e("br"),e("input",{staticClass:"form-control-file",attrs:{type:"file",id:"image",name:"image"},on:{change:t.handleFileChange}})]),e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.isProcessing,type:"submit"}},[t._v(" "+t._s(t.isProcessing?"處理中...":"送出"))])])])])])},s=[],n=a(3459),i=a(4711),o=a(6163),u={data(){return{restaurant:{name:"",CategoryId:"",tel:"",address:"",description:"",image:"",opening_hours:""},categories:[],isLoading:!0}},props:{initialRestaurant:{type:Object,default:()=>({name:"",categoryId:"",tel:"",address:"",description:"",image:"",openingHours:""})},isProcessing:{type:Boolean,default:!1}},watch:{initialRestaurant(t,e){this.restaurant={...this.restaurant,...t}}},created(){this.fetchCategories(),this.restaurant={...this.restaurant,...this.initialRestaurant}},methods:{async fetchCategories(){try{const t=await(0,i.Kf)();if("error"===t.data.status)throw new Error(data.message);this.categories=t.data.categories,this.isLoading=!1}catch(t){this.isLoading=!1,o.F.fire({icon:"error",title:"無法取得餐廳類別，請稍後再試"})}},handleFileChange(t){const{files:e}=t.target;0===e.length?this.restaurant.image="":this.restaurant.image=window.URL.createObjectURL(e[0])},handleSubmit(t){const e=t.target,a=new FormData(e);this.$emit("after-submit",a)}},mixins:[n.L]},l=u,d=a(1001),c=(0,d.Z)(l,r,s,!1,null,null,null),m=c.exports},8591:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container py-5"},[e("AdminRestaurantsForm",{attrs:{initialRestaurant:t.restaurant,isProcessing:t.isProcessing},on:{"after-submit":t.handleAfterSubmit}})],1)},s=[],n=(a(7658),a(1568)),i=a(4711),o=a(6163),u={name:"AdminRestaurantEdit",data(){return{restaurant:{},isProcessing:!1}},components:{AdminRestaurantsForm:n.Z},created(){const{id:t}=this.$route.params;this.fetchRestaurant(t)},beforeRouteUpdate(t,e,a){const{id:r}=t.params;this.fetchRestaurant(r),a()},methods:{async fetchRestaurant(t){try{const e=await(0,i.Pt)({restaurantId:t});if("error"===e.status)throw new Error(e.statusText);this.restaurant=e.data.restaurant}catch(e){o.F.fire({icon:"error",title:"無法取得餐廳資訊，請稍後再試"})}},async handleAfterSubmit(t){try{this.isProcessing=!0;const{data:e}=await(0,i.W6)({restaurantId:this.restaurant.id,formData:t});if("error"===e.status)throw new Error(e.message);this.$router.push({name:"admin-restaurants"})}catch(e){this.isProcessing=!1,o.F.fire({icon:"error",title:"無法修改餐廳內容，請稍後再試"})}}}},l=u,d=a(1001),c=(0,d.Z)(l,r,s,!1,null,null,null),m=c.exports},4711:function(t,e,a){a.d(e,{ER:function(){return n},Kf:function(){return s},Pt:function(){return c},W6:function(){return m},Xx:function(){return l},Z$:function(){return d},_9:function(){return i},aW:function(){return o},yd:function(){return u}});var r=a(6163);const s=()=>r.l.get("/admin/categories"),n=({name:t})=>r.l.post("/admin/categories",{name:t}),i=t=>r.l["delete"](`/admin/categories/${t}`),o=({CategoryId:t,name:e})=>r.l.put(`/admin/categories/${t}`,{name:e}),u=t=>r.l.post("/admin/restaurants",t),l=()=>r.l.get("/admin/restaurants"),d=t=>r.l["delete"](`/admin/restaurants/${t}`),c=({restaurantId:t})=>r.l.get(`/admin/restaurants/${t}`),m=({restaurantId:t,formData:e})=>r.l.put(`/admin/restaurants/${t}`,e)}}]);
//# sourceMappingURL=591.b5805aed.js.map